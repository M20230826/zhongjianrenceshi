#ifndef __CONTROL_H
#define __CONTROL_H

#include "sys.h"

// 常量定义
#define Pi 3.14159265

// 函数声明

/**************************************************************************
 * 函数: Kinematic_Analysis
 * 描述: 执行差速驱动车辆的运动学分析
 * 输入: float velocity - 线速度
 *       float angle - 转向角度
 * 输出: 无
 **************************************************************************/
void Kinematic_Analysis(float velocity, float angle);

/**************************************************************************
 * 函数: TIM2_IRQHandler
 * 描述: 定时器2中断处理函数
 * 输入: 无
 * 输出: 无
 **************************************************************************/
void TIM2_IRQHandler(void);

/**************************************************************************
 * 函数: Set_Pwm
 * 描述: 设置电机的PWM值
 * 输入: int motor_a - 电机A的PWM值
 *       int motor_b - 电机B的PWM值
 * 输出: 无
 **************************************************************************/
void Set_Pwm(int motor_a, int motor_b);

/**************************************************************************
 * 函数: Key
 * 描述: 处理按键事件
 * 输入: 无
 * 输出: 无
 **************************************************************************/
void Key(void);

/**************************************************************************
 * 函数: Limit_Pwm
 * 描述: 限制PWM值以防止电机过载
 * 输入: 无
 * 输出: 无
 **************************************************************************/
void Limit_Pwm(void);

/**************************************************************************
 * 函数: Turn_Off
 * 描述: 检查电池电压以决定是否关闭电机
 * 输入: int voltage - 当前电池电压
 * 输出: u8 - 如果电压低或停止标志设置为1，否则为0
 **************************************************************************/
u8 Turn_Off(int voltage);

/**************************************************************************
 * 函数: Get_Angle
 * 描述: 获取角度数据
 * 输入: u8 way - 获取角度数据的方式
 * 输出: 无
 **************************************************************************/
void Get_Angle(u8 way);

/**************************************************************************
 * 函数: myabs
 * 描述: 计算整数的绝对值
 * 输入: int a - 输入整数
 * 输出: int - 输入整数的绝对值
 **************************************************************************/
int myabs(int a);

/**************************************************************************
 * 函数: Incremental_PI_A
 * 描述: 电机A的增量PI控制器
 * 输入: int Encoder - 当前编码器值
 *       int Target - 目标值
 * 输出: int - PWM值
 **************************************************************************/
int Incremental_PI_A(int Encoder, int Target);

/**************************************************************************
 * 函数: Incremental_PI_B
 * 描述: 电机B的增量PI控制器
 * 输入: int Encoder - 当前编码器值
 *       int Target - 目标值
 * 输出: int - PWM值
 **************************************************************************/
int Incremental_PI_B(int Encoder, int Target);

/**************************************************************************
 * 函数: Get_RC
 * 描述: 处理遥控输入
 * 输入: 无
 * 输出: 无
 **************************************************************************/
void Get_RC(void);

#endif // __CONTROL_H
